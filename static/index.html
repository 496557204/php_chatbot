<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能安全管理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus/dist/index.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router@4.1.6/dist/vue-router.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus/dist/index.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="app.js" defer></script>
</head>
<body>
    <div id="app">
        <el-container style="height: 100vh;">
            <!-- 登录界面 -->
            <div v-if="!isAuthenticated" class="login-container">
                <div class="login-background">
                    <div class="login-shapes">
                        <div class="shape shape-1"></div>
                        <div class="shape shape-2"></div>
                        <div class="shape shape-3"></div>
                    </div>
                </div>
                <el-card class="login-card">
                    <div class="login-header">
                        <div class="login-logo">
                            <i class="el-icon-lock"></i>
                        </div>
                        <h2 class="login-title">智能安全管理系统</h2>
                        <p class="login-subtitle">安全 · 智能 · 高效</p>
                    </div>
                    <el-form :model="loginForm" :rules="loginRules" ref="loginFormRef" class="login-form">
                        <el-form-item prop="username">
                            <el-input
                                v-model="loginForm.username"
                                placeholder="请输入用户名"
                                prefix-icon="User"
                                size="large"
                            >
                                <template #prefix>
                                    <el-icon><User /></el-icon>
                                </template>
                            </el-input>
                        </el-form-item>
                        <el-form-item prop="password">
                            <el-input
                                v-model="loginForm.password"
                                placeholder="请输入密码"
                                type="password"
                                prefix-icon="Lock"
                                show-password
                                size="large"
                                @keyup.enter="handleLogin"
                            >
                                <template #prefix>
                                    <el-icon><Lock /></el-icon>
                                </template>
                            </el-input>
                        </el-form-item>
                        <el-form-item>
                            <el-button
                                type="primary"
                                @click="handleLogin"
                                size="large"
                                style="width: 100%; height: 44px; font-size: 16px;"
                                :loading="loginLoading"
                            >
                                登录
                            </el-button>
                        </el-form-item>
                        <div class="login-footer">
                            <el-link type="primary" @click="showRegister = true">注册新账户</el-link>
                            <el-link type="info">忘记密码？</el-link>
                        </div>
                    </el-form>
                </el-card>
            </div>

            <!-- 主界面 -->
            <div v-else class="main-container">
                <el-header class="header">
                    <div class="header-left">
                        <div class="logo">
                            <i class="el-icon-lock"></i>
                        </div>
                        <span class="system-name">智能安全管理系统</span>
                    </div>
                    <div class="header-right">
                        <el-dropdown @command="handleCommand">
                            <span class="user-info">
                                <el-avatar :size="32" :src="avatarUrl" />
                                <span class="username">{{ currentUser.username }}</span>
                                <el-tag :type="roleTagType" size="small">{{ currentUser.role }}</el-tag>
                                <el-icon class="el-icon--right"><arrow-down /></el-icon>
                            </span>
                            <template #dropdown>
                                <el-dropdown-menu>
                                    <el-dropdown-item command="profile">
                                        <el-icon><User /></el-icon>个人中心
                                    </el-dropdown-item>
                                    <el-dropdown-item command="settings">
                                        <el-icon><Setting /></el-icon>系统设置
                                    </el-dropdown-item>
                                    <el-dropdown-item divided command="logout">
                                        <el-icon><SwitchButton /></el-icon>退出登录
                                    </el-dropdown-item>
                                </el-dropdown-menu>
                            </template>
                        </el-dropdown>
                    </div>
                </el-header>

                <el-container>
                    <el-aside width="220px" class="sidebar">
                        <div class="sidebar-header">
                            <h3>功能菜单</h3>
                        </div>
                        <el-menu
                            :default-active="activeMenu"
                            router
                            class="sidebar-menu"
                        >
                            <el-menu-item
                                v-for="menu in menuItems"
                                :key="menu.id"
                                :index="menu.path"
                            >
                                <el-icon>
                                    <component :is="menu.icon.replace('el-icon-', '')" />
                                </el-icon>
                                <span>{{ menu.name }}</span>
                            </el-menu-item>
                        </el-menu>
                    </el-aside>

                    <el-main class="content">
                        <router-view></router-view>
                    </el-main>
                </el-container>
            </div>
        </el-container>
    </div>
</body>
</html>
